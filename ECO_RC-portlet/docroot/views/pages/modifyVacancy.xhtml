<f:view xmlns="http://www.w3.org/1999/xhtml"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:ui="http://java.sun.com/jsf/facelets">
	<h:head />
	<h:body>
		<h:form id="modifyVacancy"
			rendered="#{vacancyViewBean.currentMode==2 || vacancyViewBean.currentMode==3}">

			<p:remoteCommand name="refreshDocuments"
				update=":modifyVacancy:accordion:documents" />

			<p:outputPanel id="vacancyOutputPanel">
				<p:messages id="msgs" />
				<p:accordionPanel id="accordion" multiple="true"
					style="margin-bottom:20px;" activeIndex="0">
					<p:tab id="vacancyBasicInfoTab" title="Basic Information">
						<p:panelGrid columns="2" layout="grid">
							<h:panelGroup>
								<p:panelGrid columns="2">

									<h:outputText value="Position: " />
									<h:panelGroup id="titlesNameGroup">
										<h:outputText value="#{vacancyBean.currentTitlesName}" />
										<p:commandLink style="margin-left: 15px;"
											value="#{vacancyBean.vacancyItem.titles != null ? 'change...' : 'choose...'}"
											onclick="PF('titlesSelectDialog').show();" />
									</h:panelGroup>

									<h:outputText value="Number of Approved Position" />
									<p:inputText
										value="#{vacancyBean.vacancyItem.vacancy.approvedNumberOfPosition}" />

									<h:outputText value="Number of Current Employee" />
									<p:inputText
										value="#{vacancyBean.vacancyItem.vacancy.currentNumberOfEmployee}" />

									<h:outputText value="Number of New Recruitment" />
									<p:inputText
										value="#{vacancyBean.vacancyItem.vacancy.numberOfNewRecruitment}" />

									<h:outputText value="Number of Replaced Recruitment" />
									<p:inputText
										value="#{vacancyBean.vacancyItem.vacancy.numberOfReplacedRecruitment}" />

									<h:outputText value="Expected Salary" />
									<p:inputText
										value="#{vacancyBean.vacancyItem.vacancy.expectedSalary}" />

									<h:outputText value="Expected Joined Date" />
									<p:calendar
										value="#{vacancyBean.vacancyItem.vacancy.expectedJoinedDate}" />

									<h:outputText value="Working Place" />
									<p:inputText
										value="#{vacancyBean.vacancyItem.vacancy.workingPlace}" />

									<h:outputText value="Required Education: " />
									<p:selectOneMenu id="certificateTypeSelect"
										value="#{vacancyBean.vacancyItem.vacancy.certificateType}">
										<f:selectItem itemLabel="Certificate Type" itemValue="" />
										<f:selectItems value="#{vacancyBean.certificateTypes}" var="t"
											itemLabel="#{i18n[vacancyBean.getTypeLocalizedString(t)]}"
											itemValue="#{t}" />
									</p:selectOneMenu>

									<h:outputText value="Required Experiences: " />
									<p:inputText id="experiences"
										value="#{vacancyBean.vacancyItem.vacancy.experiences}" />

									<h:outputText value="Description: " />
									<p:inputTextarea id="vDescription" placeholder="Description..."
										value="#{vacancyBean.vacancyItem.vacancy.description}" />
								</p:panelGrid>
							</h:panelGroup>

							<h:panelGroup>


								<p:panelGrid columns="2">
									<h:outputText value="Upload Documents" />
									<h:panelGroup>
										<p:fileUpload
											fileUploadListener="#{vacancyBean.handleFileUpload}"
											oncomplete="refreshDocuments();" mode="advanced"
											dragDropSupport="true" multiple="true"
											update=":modifyVacancy:msgs :modifyVacancy:accordion:noDocsPlaceHolder"
											sizeLimit="10000000" fileLimit="3"
											allowTypes="/(\.|\/)(doc|docx|pdf)$/" />
									</h:panelGroup>

									<h:outputText value="Current Documents" />
									<h:panelGroup id="documents">
										<ui:repeat var="doc" id="vacancyDocuments"
											rendered="#{vacancyBean.vacancyItem.documentItems.size() > 0}"
											value="#{vacancyBean.vacancyItem.documentItems}">
											<p:commandLink value="#{doc.fileName}"
												actionListener="#{vacancyBean.onPreviewFile(doc.fileEntryId)}"
												oncomplete="PF('wPreviewDialog').show();" />
											<p:commandLink value="[Remove]"
												onclick="PF('wDeleteConfirmDialog').show()"
												styleClass="currentStatus status-red"
												style="margin-left: 30px">
												<f:setPropertyActionListener
													target="#{vacancyBean.deletedDocument}" value="#{doc}" />
											</p:commandLink>
											<br />
										</ui:repeat>
										<h:outputText value="No documents exist"
											id="noDocsPlaceHolder"
											rendered="#{vacancyBean.vacancyItem.documentItems.size() eq 0}" />
									</h:panelGroup>

									<h:outputText value="Posted Date: " />
									<p:calendar id="vPostedDate" mask="false"
										widgetVar="wPostedDate"
										value="#{vacancyBean.vacancyItem.vacancy.postedDate}"
										pattern="dd/MM/yyyy" styleClass="calendarClass">
									</p:calendar>

									<h:outputText value="Expired Date: " />
									<p:calendar id="vExpiredDate" mask="false"
										widgetVar="wExpiredDate"
										value="#{vacancyBean.vacancyItem.vacancy.expiredDate}"
										pattern="dd/MM/yyyy" styleClass="calendarClass">
									</p:calendar>

									<h:outputText value="Status: " />
									<p:selectOneMenu id="vStatusSelect"
										value="#{vacancyBean.vacancyItem.vacancy.status}">
										<f:selectItem itemLabel="Status" itemValue="" />
										<f:selectItems value="#{vacancyBean.vacancyStatuses}"
											var="status" itemValue="#{status}" itemLabel="#{status}" />
									</p:selectOneMenu>
								</p:panelGrid>
							</h:panelGroup>
						</p:panelGrid>
					</p:tab>
					<p:tab id="evaluationInfoTab" title="Evaluation Information"
						rendered="false">

					</p:tab>
				</p:accordionPanel>
				<p:commandButton id="vSave" value="Save"
					action="#{vacancyBean.onSave}"
					update=":VacancyPanelGroup vacancyOutputPanel :vacancyMainForm:vacancies" /> |
				<p:commandLink id="vCancel" style="margin-left: 3px;"
					actionListener="#{vacancyBean.onCancel}" immediate="true"
					update=":VacancyPanelGroup" value="Cancel" />
			</p:outputPanel>

			<!-- DELETE CONFIRMATION DIALOG -->
			<p:confirmDialog id="deleteConfirmDialog"
				widgetVar="wDeleteConfirmDialog" message="Delete this File?"
				header="Delete Confirmation" severity="alert" closeOnEscape="true"
				showEffect="fade">
				<p:commandButton id="confirmDelete" value="Yes"
					styleClass="RedButton"
					oncomplete="refreshDocuments(); PF('wDeleteConfirmDialog').hide()"
					actionListener="#{vacancyBean.deleteFileEntry}"
					update=":modifyVacancy:accordion:noDocsPlaceHolder" />
				<p:commandButton id="discardDelete" value="No"
					onclick="PF('wDeleteConfirmDialog').hide()" />
			</p:confirmDialog>
		</h:form>

		<h:form>
			<p:dialog widgetVar="titlesSelectDialog" showHeader="false">
				<p:outputPanel>
					<h:panelGrid columns="2">
						<h:outputText value="Devision" />
						<p:selectOneMenu id="devisionSelect"
							value="#{titlesActionBean.devision}"
							converter="devisionConverter" effect="fade" filter="true"
							filterMatchMode="contains" var="d">
							<p:ajax
								update="departmentSelect unitSelect unitGroupSelect titlesSelect"
								listener="#{titlesActionBean.onDevisionChanged}" />

							<f:selectItem itemLabel="Devision" itemValue="" />
							<f:selectItems value="#{titlesActionBean.devisions}" var="d"
								itemLabel="#{d.name}" itemValue="#{d}" />
							<p:column>
					                #{d.name}
					            </p:column>
						</p:selectOneMenu>

						<h:outputText value="Department" />
						<p:selectOneMenu id="departmentSelect"
							value="#{titlesActionBean.department}"
							converter="departmentConverter" effect="fade" filter="true"
							filterMatchMode="contains" var="d">
							<p:ajax update="unitSelect unitGroupSelect titlesSelect"
								listener="#{titlesActionBean.onDepartmentChanged}" />

							<f:selectItem itemLabel="Department" itemValue="" />
							<f:selectItems value="#{titlesActionBean.departments}" var="d"
								itemLabel="#{d.name}" itemValue="#{d}" />
							<p:column>
					                #{d.name}
					            </p:column>
						</p:selectOneMenu>

						<h:outputText value="Unit" />
						<p:selectOneMenu id="unitSelect" value="#{titlesActionBean.unit}"
							converter="unitConverter" effect="fade" filter="true"
							filterMatchMode="contains" var="u">
							<p:ajax update="unitGroupSelect titlesSelect"
								listener="#{titlesActionBean.onUnitChanged}" />

							<f:selectItem itemLabel="Unit" itemValue="" />
							<f:selectItems value="#{titlesActionBean.units}" var="u"
								itemLabel="#{u.name}" itemValue="#{u}" />
							<p:column>
					                #{u.name}
					            </p:column>
						</p:selectOneMenu>

						<h:outputText value="Group" />
						<p:selectOneMenu id="unitGroupSelect"
							value="#{titlesActionBean.unitGroup}"
							converter="unitGroupConverter" effect="fade" filter="true"
							filterMatchMode="contains" var="g">
							<p:ajax update="titlesSelect"
								listener="#{titlesActionBean.onUnitGroupChanged}" />

							<f:selectItem itemLabel="Group" itemValue="" />
							<f:selectItems value="#{titlesActionBean.unitGroups}" var="g"
								itemLabel="#{g.name}" itemValue="#{g}" />
							<p:column>
					                #{g.name}
					            </p:column>
						</p:selectOneMenu>

						<h:outputText value="Titles" />
						<p:selectOneMenu id="titlesSelect"
							value="#{titlesActionBean.titles}" converter="titlesConverter"
							effect="fade" filter="true" filterMatchMode="contains" var="t"
							required="true" validatorMessage="[Titles] is required">

							<f:selectItem itemLabel="Titles" itemValue="" />
							<f:selectItems value="#{titlesActionBean.titlesList}" var="t"
								itemLabel="#{t.name}" itemValue="#{t}" />
							<p:column>
					        	#{t.name}
					        </p:column>
						</p:selectOneMenu>
					</h:panelGrid>
				</p:outputPanel>
				<br />
				<br />
				<p:commandLink value="Update Titles"
					actionListener="#{titlesActionBean.onUpdateTitles}"
					update=":modifyVacancy:accordion:titlesNameGroup"
					oncomplete="PF('titlesSelectDialog').hide();" /> |
				<p:commandLink value="Cancel" style="margin-left: 2px;"
					onclick="PF('titlesSelectDialog').hide();" />
			</p:dialog>
		</h:form>


	</h:body>
</f:view>