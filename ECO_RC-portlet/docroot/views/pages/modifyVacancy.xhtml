<f:view xmlns="http://www.w3.org/1999/xhtml"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:eco="http://java.sun.com/jsf/composite/eco_composite">
	<h:head />
	<h:body>
		<h:form id="modifyVacancy"
			rendered="#{vacancyViewBean.currentMode==2 || vacancyViewBean.currentMode==3}">

			<p:outputPanel id="vacancyOutputPanel">
				<p:messages id="msgs" />
				<p:accordionPanel id="accordion" multiple="true"
					style="margin-bottom:20px;" activeIndex="0">
					<p:tab id="vacancyBasicInfoTab" title="Basic Information">
						<p:panelGrid columns="2" layout="grid">
							<h:panelGroup>
								<p:panelGrid columns="2">

									<h:outputText value="Position: " />
									<h:panelGroup id="titlesNameGroup">
										<h:outputText value="#{vacancyBean.currentTitlesName}" />
										<p:commandLink style="margin-left: 15px;"
											value="#{vacancyBean.vacancyItem.titles != null ? 'change...' : 'choose...'}"
											onclick="PF('titlesSelectDialog').show();" />
									</h:panelGroup>

									<h:outputText value="Number of Approved Position" />
									<p:inputText
										value="#{vacancyBean.vacancyItem.object.approvedNumberOfPosition}" />

									<h:outputText value="Number of Current Employee" />
									<p:inputText
										value="#{vacancyBean.vacancyItem.object.currentNumberOfEmployee}" />

									<h:outputText value="Number of New Recruitment" />
									<p:inputText
										value="#{vacancyBean.vacancyItem.object.numberOfNewRecruitment}" />

									<h:outputText value="Number of Replaced Recruitment" />
									<p:inputText
										value="#{vacancyBean.vacancyItem.object.numberOfReplacedRecruitment}" />

									<h:outputText value="Expected Salary" />
									<p:inputText
										value="#{vacancyBean.vacancyItem.object.expectedSalary}" />

									<h:outputText value="Expected Joined Date" />
									<p:calendar
										value="#{vacancyBean.vacancyItem.object.expectedJoinedDate}" />

									<h:outputText value="Working Place" />
									<p:inputText
										value="#{vacancyBean.vacancyItem.object.workingPlace}" />

									<h:outputText value="Required Education: " />
									<p:selectOneMenu id="certificateTypeSelect"
										value="#{vacancyBean.vacancyItem.object.certificateType}">
										<f:selectItem itemLabel="Certificate Type" itemValue="" />
										<f:selectItems value="#{vacancyBean.certificateTypes}" var="t"
											itemLabel="#{i18n[vacancyBean.getTypeLocalizedString(t)]}"
											itemValue="#{t}" />
									</p:selectOneMenu>

									<h:outputText value="Required Experiences: " />
									<p:inputText id="experiences"
										value="#{vacancyBean.vacancyItem.object.experiences}" />

									<h:outputText value="Description: " />
									<p:inputTextarea id="vDescription" placeholder="Description..."
										value="#{vacancyBean.vacancyItem.object.description}" />
								</p:panelGrid>
							</h:panelGroup>

							<h:panelGroup>
								<p:panelGrid columns="2">
									<h:outputText value="Documents" />
									<p:outputPanel autoUpdate="true" id="documentOutputPanel">
										<h:panelGroup id="noDocsPanelGroup" styleClass="panel-message"
											rendered="#{vacancyBean.vacancyItem.emptyDocuments}">
											<h:outputText styleClass="no-item-label" value="No Documents" />
											<br />
											<p:commandLink value="Upload Document"
												onclick="PF('wUploadDocumentDialog').show();" />
										</h:panelGroup>

										<h:panelGroup
											rendered="#{not vacancyBean.vacancyItem.emptyDocuments}">
											<ui:repeat var="doc"
												value="#{vacancyBean.vacancyItem.documents}"
												varStatus="status">
												<h:panelGroup rendered="#{not doc.UIDeleted}">

													<p:commandLink value="#{doc.fileEntry.title}"
														onclick="window.location = '#{doc.fileURL}'" />
													<p:commandLink value="[X]" style="margin-left: 5px;"
														onclick="PF('wDeleteDocumentConfirmDialog').show()">
														<f:setPropertyActionListener value="#{status.index}"
															target="#{vacancyBean.deletedDocumentIndex}" />
													</p:commandLink>
												</h:panelGroup>
											</ui:repeat>
										</h:panelGroup>
									</p:outputPanel>

									<h:outputText value="Posted Date: " />
									<p:calendar id="vPostedDate" mask="false"
										widgetVar="wPostedDate"
										value="#{vacancyBean.vacancyItem.object.postedDate}"
										pattern="dd/MM/yyyy" styleClass="calendarClass">
									</p:calendar>

									<h:outputText value="Expired Date: " />
									<p:calendar id="vExpiredDate" mask="false"
										widgetVar="wExpiredDate"
										value="#{vacancyBean.vacancyItem.object.expiredDate}"
										pattern="dd/MM/yyyy" styleClass="calendarClass">
									</p:calendar>

									<h:outputText value="Status: " />
									<p:selectOneMenu id="vStatusSelect"
										value="#{vacancyBean.vacancyItem.object.status}">
										<f:selectItem itemLabel="Status" itemValue="" />
										<f:selectItems value="#{vacancyBean.vacancyStatuses}"
											var="status" itemValue="#{status}" itemLabel="#{status}" />
									</p:selectOneMenu>
								</p:panelGrid>
							</h:panelGroup>
						</p:panelGrid>
					</p:tab>
					<p:tab id="evaluationInfoTab" title="Evaluation Information"
						rendered="false">

					</p:tab>
				</p:accordionPanel>
				<p:commandButton id="vSave" value="Save"
					action="#{vacancyBean.onSave}"
					update=":VacancyPanelGroup vacancyOutputPanel :vacancyMainForm:vacancies" /> |
				<p:commandLink id="vCancel" style="margin-left: 3px;"
					actionListener="#{vacancyBean.onCancel}" immediate="true"
					update=":VacancyPanelGroup" value="Cancel" />
			</p:outputPanel>
		</h:form>

		<h:form>
			<p:dialog widgetVar="titlesSelectDialog" showHeader="false"
				modal="true">
				<p:outputPanel>
					<h:panelGrid columns="2">
						<h:outputText value="Devision" />
						<p:selectOneMenu id="devisionSelect"
							value="#{titlesActionBean.devision}"
							converter="devisionConverter" effect="fade" filter="true"
							filterMatchMode="contains" var="d">
							<p:ajax
								update="departmentSelect unitSelect unitGroupSelect titlesSelect"
								listener="#{titlesActionBean.onDevisionChanged}" />

							<f:selectItem itemLabel="Devision" itemValue="" />
							<f:selectItems value="#{titlesActionBean.devisions}" var="d"
								itemLabel="#{d.name}" itemValue="#{d}" />
							<p:column>
					                #{d.name}
					            </p:column>
						</p:selectOneMenu>

						<h:outputText value="Department" />
						<p:selectOneMenu id="departmentSelect"
							value="#{titlesActionBean.department}"
							converter="departmentConverter" effect="fade" filter="true"
							filterMatchMode="contains" var="d">
							<p:ajax update="unitSelect unitGroupSelect titlesSelect"
								listener="#{titlesActionBean.onDepartmentChanged}" />

							<f:selectItem itemLabel="Department" itemValue="" />
							<f:selectItems value="#{titlesActionBean.departments}" var="d"
								itemLabel="#{d.name}" itemValue="#{d}" />
							<p:column>
					                #{d.name}
					            </p:column>
						</p:selectOneMenu>

						<h:outputText value="Unit" />
						<p:selectOneMenu id="unitSelect" value="#{titlesActionBean.unit}"
							converter="unitConverter" effect="fade" filter="true"
							filterMatchMode="contains" var="u">
							<p:ajax update="unitGroupSelect titlesSelect"
								listener="#{titlesActionBean.onUnitChanged}" />

							<f:selectItem itemLabel="Unit" itemValue="" />
							<f:selectItems value="#{titlesActionBean.units}" var="u"
								itemLabel="#{u.name}" itemValue="#{u}" />
							<p:column>
					                #{u.name}
					            </p:column>
						</p:selectOneMenu>

						<h:outputText value="Group" />
						<p:selectOneMenu id="unitGroupSelect"
							value="#{titlesActionBean.unitGroup}"
							converter="unitGroupConverter" effect="fade" filter="true"
							filterMatchMode="contains" var="g">
							<p:ajax update="titlesSelect"
								listener="#{titlesActionBean.onUnitGroupChanged}" />

							<f:selectItem itemLabel="Group" itemValue="" />
							<f:selectItems value="#{titlesActionBean.unitGroups}" var="g"
								itemLabel="#{g.name}" itemValue="#{g}" />
							<p:column>
					                #{g.name}
					            </p:column>
						</p:selectOneMenu>

						<h:outputText value="Titles" />
						<p:selectOneMenu id="titlesSelect"
							value="#{titlesActionBean.titles}" converter="titlesConverter"
							effect="fade" filter="true" filterMatchMode="contains" var="t"
							required="true" validatorMessage="[Titles] is required">

							<f:selectItem itemLabel="Titles" itemValue="" />
							<f:selectItems value="#{titlesActionBean.titlesList}" var="t"
								itemLabel="#{t.name}" itemValue="#{t}" />
							<p:column>
					        	#{t.name}
					        </p:column>
						</p:selectOneMenu>
					</h:panelGrid>
				</p:outputPanel>
				<br />
				<br />
				<p:commandLink value="Update Titles"
					actionListener="#{titlesActionBean.onUpdateTitles}"
					update=":modifyVacancy:accordion:titlesNameGroup"
					oncomplete="PF('titlesSelectDialog').hide();" /> |
				<p:commandLink value="Cancel" style="margin-left: 2px;"
					onclick="PF('titlesSelectDialog').hide();" />
			</p:dialog>
		</h:form>


		<!-- DIALOGS -->
		<eco:confirmDialog wDialogVar="wDeleteDocumentConfirmDialog"
			message="Delete this document?" header="Delete Confirmation"
			onAction="#{vacancyBean.deleteDocument}"
			oncompleteActions="PF('wDeleteDocumentConfirmDialog').hide();"
			update="" />

		<h:form id="uploadDocumentForm">
			<p:dialog widgetVar="wUploadDocumentDialog" modal="true" height="252"
				showHeader="false" closable="true" closeOnEscape="true">
				<p:outputPanel>
					<p:panelGrid columns="2">
						<h:outputText value="Document Type: " />
						<p:selectOneMenu id="documentTypeSelect" var="t"
							value="#{vacancyBean.selectedDocumentType}">
							<f:selectItems value="#{vacancyBean.allDocumentTypes}"
								itemLabel="#{t}" itemValue="#{t}" />
						</p:selectOneMenu>
					</p:panelGrid>
					<p:fileUpload
						fileUploadListener="#{vacancyBean.handleDocumentUpload}"
						dragDropSupport="false" multiple="false" id="documentUploader"
						sizeLimit="1000000" allowTypes="/(\.|\/)(doc|docx|pdf)$/" />
				</p:outputPanel>
			</p:dialog>
		</h:form>

	</h:body>
</f:view>