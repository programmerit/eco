<?xml version="1.0"?>

<f:view xmlns="http://www.w3.org/1999/xhtml"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions"
	xmlns:eco="http://java.sun.com/jsf/composite/eco_composite"
	xmlns:liferay-security="http://liferay.com/faces/security">
	<h:head />

	<h:body>
		<h:form id="searchForm">
			<p:remoteCommand name="refreshFooter"
				update=":employeesForm:employees:totalFilteredCount" />

			<p:remoteCommand name="refreshEmployees"
				update=":employeesForm:employees" />

			<p:remoteCommand name="filterEmployees"
				oncomplete="PF('employeeTable').filter();" />

			<p:remoteCommand name="delayGlobalFilter"
				oncomplete="PF('employeeTable').filter(); refreshFooter();" />

			<p:remoteCommand name="showHideFilterPanel"
				update=":searchForm:filterGroup" />

			<h:link value="Show/Hide filter" styleClass="label"
				onmouseover="toggle('#{requestScope.filterGrid.clientId}'); return false;"
				onclick="toggle('#{requestScope.filterGrid.clientId}'); return false;" />

			<h:panelGroup binding="#{requestScope.filterGrid}" id="filterGroup"
				style="display: none;">
				<p:panelGrid id="filterGrid" columns="5" styleClass="filter-grid"
					style="margin-bottom: 7px!important; color: black!important;">
					<h:panelGroup>
						<p:inputText id="filter_globalString"
							value="#{empFilterBean.globalString}" placeholder="Everything"
							style="width: 150px;">
							<p:ajax event="keyup" delay="1000"
								oncomplete="PF('employeeTable').filter(); refreshFooter();" />
						</p:inputText>
						<p:tooltip for="filter_globalString" value="Filter Everything"
							showEffect="clip" hideEffect="explode" />
						<br />

						<p:inputText id="filter_fullName"
							value="#{empFilterBean.fullName}" placeholder="FullName"
							style="width: 150px;">
							<p:ajax event="keyup" delay="1000"
								oncomplete="PF('employeeTable').filter(); refreshFooter();" />
						</p:inputText>
						<p:tooltip for="filter_fullName" value="Filter [Fullname]"
							showEffect="clip" hideEffect="explode" />
					</h:panelGroup>

					<h:panelGroup>
						<p:inputText id="filter_empCode"
							value="#{empFilterBean.employeeCode}" placeholder="Employee Code"
							style="width: 150px">
							<p:ajax event="keyup" delay="1000"
								oncomplete="PF('employeeTable').filter(); refreshFooter();" />
						</p:inputText>
						<p:tooltip for="filter_empCode" value="Filter [Employee Code]"
							showEffect="clip" hideEffect="explode" />
						<br />

						<p:selectManyButton id="filter_empGender"
							value="#{empFilterBean.selectedGenders}" styleClass="GrayButton">
							<f:selectItem itemLabel="Male" itemValue="Male" />
							<f:selectItem itemLabel="Female" itemValue="Female" />
							<p:ajax event="change"
								oncomplete="PF('employeeTable').filter(); refreshFooter();" />
						</p:selectManyButton>
						<p:tooltip for="filter_empGender" value="Filter [Gender]"
							showEffect="clip" hideEffect="explode" />
					</h:panelGroup>

					<h:panelGroup>
						<h:panelGroup>
							<p:calendar id="calendarJoinedDateFrom" mask="false"
								widgetVar="wCalendarJoinedDateFrom"
								value="#{empFilterBean.joinedDateFrom}" pattern="dd/MM/yyyy"
								styleClass="calendarClass" placeholder="From" navigator="true">
								<p:ajax event="dateSelect"
									oncomplete="PF('employeeTable').filter(); refreshFooter();" />
							</p:calendar>
							<p:tooltip for="calendarJoinedDateFrom"
								value="Filter [Joined Date] From" showEffect="clip"
								hideEffect="explode" />
							<p:commandLink value="x"
								actionListener="#{empFilterBean.resetJoinedDateFrom}"
								oncomplete="PF('employeeTable').filter(); refreshFooter();"
								ajax="true" update=":searchForm:calendarJoinedDateFrom" />
						</h:panelGroup>
						<br />
						<h:panelGroup>
							<p:calendar id="calendarJoinedDateTo" mask="false"
								widgetVar="wCalendarJoinedDateTo"
								value="#{empFilterBean.joinedDateTo}" pattern="dd/MM/yyyy"
								styleClass="calendarClass" placeholder="To" navigator="true">
								<p:ajax event="dateSelect"
									oncomplete="PF('employeeTable').filter(); refreshFooter();" />
							</p:calendar>
							<p:tooltip for="calendarJoinedDateTo"
								value="Filter [Joined Date] To" showEffect="clip"
								hideEffect="explode" />
							<p:commandLink value="x"
								actionListener="#{empFilterBean.resetJoinedDateTo}"
								oncomplete="PF('employeeTable').filter(); refreshFooter();"
								ajax="true" update=":searchForm:calendarJoinedDateTo" />
						</h:panelGroup>
					</h:panelGroup>

					<!-- <h:panelGroup>
						<p:selectOneMenu id="statusSelect" value="#{empFilterBean.status}"
							var="s">
							<p:ajax event="change"
								oncomplete="PF('employeeTable').filter(); refreshFooter();" />
							<f:selectItem itemLabel="Status" itemValue="" />
							<f:selectItems value="#{empFilterBean.statuses}" var="#{s}"
								itemValue="#{s}" itemLabel="#{s}" />
							<p:column>
								#{s}
							</p:column>
						</p:selectOneMenu>
					</h:panelGroup> -->

					<h:panelGroup>
						<eco:organizationFilterPanel
							onCompleteUpdate="PF('employeeTable').filter(); refreshFooter();" />
					</h:panelGroup>
				</p:panelGrid>
			</h:panelGroup>
		</h:form>

		<h:form id="employeesForm">
			<p:contextMenu id="employeeContext" for="employees">
				<p:menuitem value="Promote New Position"
					update=":promotionForm:promotionOutputPanel"
					actionListener="#{empView.onPromotionNewPosition}"
					oncomplete="PF('wPromotionDialog').show()"
					disabled="#{employeeIndexedBean.selectedEmployeeIndexItems.size() > 1 or employeeIndexedBean.selectedEmployeeIndexItems[0].status eq 'RESIGNED'}" />

				<p:menuitem value="Resign"
					actionListener="#{empView.onResignedEmployee}"
					update=":resignationForm:resignationOutputPanel"
					oncomplete="PF('wResignationDialog').show()"
					disabled="#{employeeIndexedBean.selectedEmployeeIndexItems.size() > 1 or employeeIndexedBean.selectedEmployeeIndexItems[0].status eq 'RESIGNED'}" />

				<p:menuitem value="Add Discipline"
					actionListener="#{empView.onAddingDiscipline}"
					update=":disciplineForm:disciplineOutputPanel"
					oncomplete="PF('wDisciplineDialog').show()"
					disabled="#{not employeeIndexedBean.disciplineValid}" />
			</p:contextMenu>

			<h:outputText value="Columns to show:" styleClass="label" />

			<h:panelGrid columns="3" style="margin:10px 0">
				<p:autoComplete id="columns" multiple="true" scrollHeight="300"
					value="#{employeeIndexedBean.columnTemplates}"
					completeMethod="#{employeeIndexedBean.completeColumns}"
					var="column" itemValue="#{column}"
					itemLabel="#{i18n[employeeIndexedBean.getHeaderi18nKey(column)]}"
					autoHighlight="true" placeholder="Type to select column..."
					styleClass="column-setting">
					<p:ajax event="itemSelect" update="employees" process="@parent"
						oncomplete="PF('employeeTable').clearFilters()"
						listener="#{employeeIndexedBean.updateColumns}" />
					<p:ajax event="itemUnselect" update="employees" process="@parent"
						oncomplete="PF('employeeTable').clearFilters()"
						listener="#{employeeIndexedBean.updateColumns}" />
				</p:autoComplete>
			</h:panelGrid>

			<h:panelGroup>
				<p:commandLink value="Add Employee"
					action="#{empView.addNewEmployee}" update=":empPanelGroup"
					ajax="true"
					rendered="#{employeeModelPermission.checkPermission('ADD')}" /> |

				<p:link value="Resignation List" outcome="resignationHistory">
					<f:param name="param1" value="test" />
				</p:link> |

				<p:link value="Promotion List" outcome="promotionHistory" /> |
				
				<p:link value="Discipline List" outcome="empDiscipline" /> |	

				<p:commandLink value="Import/Export"
					actionListener="#{empView.importExportEmployee}"
					update=":empPanelGroup" /> |

				<p:commandLink value="Remove All Indexes"
					actionListener="#{employeeIndexedBean.removeIndexes}" ajax="true"
					update="employees" /> |
				<p:commandLink value="Index All Employees"
					actionListener="#{employeeIndexedBean.indexAllEmployees}"
					ajax="true" update="employees" /> |
					
				<p:link value="Organization Tree" outcome="organizationView" /> | 
				
				<p:link value="Location Tree" outcome="locationView" /> | 
				
				<p:link value="Specialized Tree" outcome="specializedView" />

			</h:panelGroup>
			<!-- EMPLOYEE TABLE-->
			<p:dataTable id="employees" var="employeeInfo" reflow="true"
				widgetVar="employeeTable"
				value="#{employeeIndexedBean.lazyDataModel}"
				paginatorAlwaysVisible="true" paginator="true" rows="50"
				paginatorPosition="bottom"
				paginatorTemplate="{FirstPageLink} {PreviousPageLink} {CurrentPageReport} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
				rowsPerPageTemplate="10,25,50" lazy="true" selectionMode="multiple"
				selection="#{employeeIndexedBean.selectedEmployeeIndexItems}"
				rowKey="#{employeeInfo.id}" emptyMessage="No employees found"
				scrollable="true" scrollRows="7">

				<p:ajax event="rowDblselect" listener="#{empView.onRowDblSelect}"
					update=":empPanelGroup" />

				<p:ajax event="rowSelect" update=":employeesForm:employeeContext" />
				<p:column style="width:16px" exportable="false" toggleable="false">
					<p:rowToggler />
				</p:column>
				<p:rowExpansion>
						No detail Information.
					</p:rowExpansion>
				<p:columns var="column" value="#{employeeIndexedBean.columns}"
					columnIndexVar="colIndex"
					sortable="#{employeeIndexedBean.getSortColumn(column.property) != ''}"
					sortBy="#{employeeIndexedBean.getSortColumn(column.property)}">
					<f:facet name="header">
						<h:outputText
							value="#{i18n[employeeIndexedBean.getHeaderi18nKey(column.header)]}" />
					</f:facet>
					<h:outputText value="#{employeeInfo[column.property]}" />
				</p:columns>
				<p:column headerText="Status" sortBy="#{empFilterBean.status}">
					<h:outputText id="employeeStatus"
						value="#{i18n[employeeInfo.statusLocalized]}" />
				</p:column>

				<p:column headerText="Actions" toggleable="false" width="100"
					exportable="false">
					<p:commandLink id="editBtn" value="Edit"
						action="#{empView.editEmployee(employeeInfo.id)}"
						update=":empPanelGroup"
						rendered="#{empPermission.checkPermission(employeeInfo.id, 'UPDATE')}" /> 
					| 
					<p:commandLink id="deleteBtn" value="Remove"
						onclick="PF('wDeleteConfirmDialog').show()"
						icon="fa fa-remove Fs16 White"
						rendered="#{empPermission.checkPermission(employeeInfo.id, 'DELETE')}">
						<f:setPropertyActionListener target="#{empView.deletedEmployeeId}"
							value="#{employeeInfo.id}" />
					</p:commandLink>
				</p:column>

				<p:column headerText="Permissions" toggleable="false"
					rendered="#{employeeModelPermission.checkPermission('PERMISSIONS')}">
					<liferay-security:permissionsURL
						modelResource="vn.com.ecopharma.emp.model.Emp"
						modelResourceDescription="Permission of #{employeeInfo.id}"
						resourcePrimKey="#{employeeInfo.id}">
				                Permission
				    </liferay-security:permissionsURL>
				</p:column>
				<f:facet name="footer">
		        		In total there are of <h:outputText id="totalFilteredCount"
						value="#{employeeIndexedBean.lazyDataModel.rowCount}" /> employees.
		   			 </f:facet>
			</p:dataTable>

			<eco:confirmDialog wDialogVar="wDeleteConfirmDialog"
				message="Delete this employee?" header="Delete Confirmation"
				onAction="#{empView.setDeleteEmployee}"
				oncompleteActions="PF('wDeleteConfirmDialog').hide(); PF('employeeTable').filter();"
				update=":employeesForm:employees" />
		</h:form>
		<ui:include src="/views/dialogs/resignedDialog.xhtml" />
		<ui:include src="/views/dialogs/promotionDialog.xhtml" />
		<ui:include src="/views/dialogs/empDisciplineDialog.xhtml" />
	</h:body>
	<script type="text/javascript">
		function toggle(id) {
			var element = document.getElementById(id);
			if (element.style.display == 'block') {
				element.style.display = 'none';
			} else {
				element.style.display = 'block'
			}
		}
	</script>

	<style type="text/css">
.column-setting select.ui-helper-hidden {
	display: none;
}

.column-setting .ui-autocomplete-multiple-container.ui-inputfield {
	width: 100%;
}

.ui-panelgrid tbody tr td {
	border: none !important;
}
</style>
</f:view>